# Standard library modules â€” non-deterministic C extensions and builtins.

[sys]
disable = ["excepthook"]

[encodings]
disable = ["search_function"]

[enum]
immutable = ["Enum"]

[os]
immutable = ["stat_result", "terminal_size", "statvfs_result"]

[types]
patch_hash = ["FunctionType"]
immutable = ["TracebackType", "ModuleType"]

[builtins]
patch_hash = ["object"]
disable = ["print"]
immutable = ["BaseException", "memoryview", "int", "float", "complex", "str", "bytes", "bool", "bytearray",
            "type", "slice"]

[_thread]
proxy = ["allocate", "allocate_lock", "RLock"]

[_datetime]
immutable = ["datetime", "tzinfo", "timezone"]

[_datetime.type_attributes]
datetime.proxy = ["now", "utcnow", "today"]

[time]
immutable = ["struct_time"]
proxy = ["perf_counter", "time", "gmtime", "localtime", "monotonic", "monotonic_ns", "time_ns"]

[pathlib]
immutable = ["PosixPath"]

[posix]
immutable = ["times_result", "statvfs_result", "uname_result", "stat_result", "terminal_size"]

proxy = [
    "_exit", # Function. Exits the process immediately, bypassing cleanup.
    "_fcopyfile", # Function. Low-level file copying (used in shutil).
    "abort", # Function. Sends SIGABRT to terminate the process.
    "access", # Function. Checks file permissions (os.access).
    "chdir", # Function. Changes the current working directory (os.chdir).
    "chflags", # Function. Sets file flags (Unix-specific).
    "chmod", # Function. Changes file permissions (os.chmod).
    "chown", # Function. Changes file ownership (os.chown).
    "chroot", # Function. Changes the root directory for the process.
    "close", # Function. Closes a file descriptor (os.close).
    "closerange", # Function. Closes a range of file descriptors.
    "confstr", # Function. Gets configuration string values (os.confstr).
    "cpu_count", # Function. Returns the number of CPUs (os.cpu_count).
    "ctermid", # Function. Returns the filename for the controlling terminal.
    "device_encoding", # Function. Returns encoding for a file descriptor.
    "dup", # Function. Duplicates a file descriptor (os.dup).
    "dup2", # Function. Duplicates a file descriptor to a specific value (os.dup2).
    "execv", # Function. Executes a program with a path and arguments (os.execv).
    "execve", # Function. Executes a program with environment variables (os.execve).
    "fchdir", # Function. Changes directory using a file descriptor.
    "fchmod", # Function. Changes permissions of a file descriptor.
    "fchown", # Function. Changes ownership of a file descriptor.
    "fork", # Function. Creates a child process (os.fork).
    "forkpty", # Function. Creates a child process with a pseudo-terminal.
    "fpathconf", # Function. Gets configuration values for a file descriptor (os.fpathconf).
    "fspath", # Function. Converts a path-like object to a string or bytes (os.fspath).
    "fstat", # Function. Gets file status for a file descriptor (os.fstat).
    "fstatvfs", # Function. Gets filesystem information for a file descriptor.
    "fsync", # Function. Synchronizes file contents to disk (os.fsync).
    "ftruncate", # Function. Truncates a file descriptor to a specified length.
    "get_blocking", # Function. Checks if a file descriptor is in blocking mode.
    "get_inheritable", # Function. Checks if a file descriptor is inheritable.
    "get_terminal_size", # Function. Returns terminal size (os.get_terminal_size).
    "getcwd", # Function. Gets the current working directory (os.getcwd).
    "getcwdb", # Function. Gets the current working directory as bytes.
    "getegid", # Function. Gets the effective group ID (os.getegid).
    "geteuid", # Function. Gets the effective user ID (os.geteuid).
    "getgid", # Function. Gets the group ID (os.getgid).
    "getgrouplist", # Function. Gets the list of groups for a user.
    "getgroups", # Function. Gets the list of supplementary group IDs.
    "getloadavg", # Function. Returns system load averages (os.getloadavg).
    "getlogin", # Function. Gets the name of the logged-in user (os.getlogin).
    "getpgid", # Function. Gets the process group ID for a process.
    "getpgrp", # Function. Gets the process group ID of the current process.
    "getpid", # Function. Gets the current process ID (os.getpid).
    "getppid", # Function. Gets the parent process ID (os.getppid).
    "getpriority", # Function. Gets the scheduling priority of a process.
    "getsid", # Function. Gets the session ID of a process.
    "getuid", # Function. Gets the user ID (os.getuid).
    "initgroups", # Function. Initializes group access list for a user.
    "isatty", # Function. Checks if a file descriptor is a terminal (os.isatty).
    "kill", # Function. Sends a signal to a process (os.kill).
    "killpg", # Function. Sends a signal to a process group.
    "lchflags", # Function. Sets flags on a symbolic link.
    "lchmod", # Function. Changes permissions of a symbolic link.
    "lchown", # Function. Changes ownership of a symbolic link.
    "link", # Function. Creates a hard link (os.link).
    "listdir", # Function. Lists directory contents (os.listdir).
    "lockf", # Function. Applies or removes advisory locks on a file descriptor.
    "login_tty", # Function. Prepares a terminal for login.
    "lseek", # Function. Repositions the file offset for a file descriptor (os.lseek).
    "lstat", # Function. Gets file status for a symbolic link (os.lstat).
    "major", # Function. Extracts the major device number from a device ID.
    "makedev", # Function. Creates a device ID from major and minor numbers.
    "minor", # Function. Extracts the minor device number from a device ID.
    "mkdir", # Function. Creates a directory (os.mkdir).
    "mkfifo", # Function. Creates a FIFO (named pipe) (os.mkfifo).
    "mknod", # Function. Creates a filesystem node (file, device, etc.).
    "nice", # Function. Adjusts process priority.
    "open", # Function. Opens a file descriptor (os.open).
    "openpty", # Function. Opens a pseudo-terminal pair.
    "pathconf", # Function. Gets configuration values for a path (os.pathconf).
    "pipe", # Function. Creates a pipe (os.pipe).
    "posix_spawn", # Function. Spawns a new process.
    "posix_spawnp", # Function. Spawns a new process using PATH.
    "pread", # Function. Reads from a file descriptor at a given offset.
    "preadv", # Function. Reads from a file descriptor into multiple buffers.
    "putenv", # Function. Sets an environment variable.
    "pwrite", # Function. Writes to a file descriptor at a given offset.
    "pwritev", # Function. Writes from multiple buffers to a file descriptor.
    "read", # Function. Reads from a file descriptor (os.read).
    "readlink", # Function. Reads the target of a symbolic link (os.readlink).
    "readv", # Function. Reads into multiple buffers from a file descriptor.

    #"register_at_fork", # Function. Registers functions to run before/after fork.

    "remove", # Function. Removes a file (os.remove).
    "rename", # Function. Renames a file or directory (os.rename).
    "replace", # Function. Renames a file, replacing the destination if it exists.
    "rmdir", # Function. Removes a directory (os.rmdir).
    "scandir", # Function. Lists directory entries with metadata (os.scandir).
    "sched_get_priority_max", # Function. Gets maximum scheduling priority.
    "sched_get_priority_min", # Function. Gets minimum scheduling priority.
    "sched_yield", # Function. Yields the processor.
    "sendfile", # Function. Transfers data between file descriptors.
    "set_blocking", # Function. Sets blocking mode for a file descriptor.
    "set_inheritable", # Function. Sets whether a file descriptor is inheritable.
    "setegid", # Function. Sets the effective group ID.
    "seteuid", # Function. Sets the effective user ID.
    "setgid", # Function. Sets the group ID.
    "setgroups", # Function. Sets supplementary group IDs.
    "setpgid", # Function. Sets the process group ID for a process.
    "setpgrp", # Function. Sets the process group ID.
    "setpriority", # Function. Sets the scheduling priority of a process.
    "setregid", # Function. Sets real and effective group IDs.
    "setreuid", # Function. Sets real and effective user IDs.
    "setsid", # Function. Creates a new session.
    "setuid", # Function. Sets the user ID.
    "stat", # Function. Gets file status (os.stat).
    "statvfs", # Function. Gets filesystem information.
    "symlink", # Function. Creates a symbolic link (os.symlink).
    "sync", # Function. Synchronizes all filesystems.
    "sysconf", # Function. Gets system configuration values (os.sysconf).
    "system", # Function. Executes a shell command (os.system).
    "tcgetpgrp", # Function. Gets the process group associated with a terminal.
    "tcsetpgrp", # Function. Sets the process group associated with a terminal.
    "times", # Function. Gets process times (os.times).
    "truncate", # Function. Truncates a file to a specified length (os.truncate).
    "ttyname", # Function. Returns the terminal name for a file descriptor.
    "umask", # Function. Sets or gets the file creation mask (os.umask).
    "uname", # Function. Gets system information (os.uname).
    "unlink", # Function. Removes a file (alias for os.remove).
    "unsetenv", # Function. Removes an environment variable.
    "urandom", # Function. Generates random bytes (os.urandom).
    "utime", # Function. Sets file access/modification times (os.utime).
    "wait", # Function. Waits for a child process to terminate.
    "wait3", # Function. Waits for a child process with options.
    "wait4", # Function. Waits for a specific child process with options.
    "waitpid", # Function. Waits for a specific process ID (os.waitpid).
    "write", # Function. Writes to a file descriptor (os.write).
    "writev", # Function. Writes from multiple buffers to a file descriptor.
    ]

[posix.wrap]
posix_spawn = "retracesoftware.install.edgecases.posix_spawn"

[_posixsubprocess]
proxy = ["fork_exec"]

[_posixsubprocess.wrap]
fork_exec = "retracesoftware.install.edgecases.fork_exec"

[fcntl]
proxy = ["fcntl", "flock", "ioctl", "lockf"]

[pwd]
proxy = ["getpwnam", "getpwuid", "getpwall"]

[grp]
proxy = ["getgrnam", "getgrgid", "getgrall"]

[_uuid]
proxy = ["generate_time_safe"]

[_locale]
proxy = ["setlocale", "localeconv", "nl_langinfo"]

[termios]
proxy = ["tcgetattr", "tcsetattr", "tcsendbreak", "tcdrain", "tcflush", "tcflow"]

[_signal]
proxy = [
    "alarm",
    "getitimer",
    "getsignal", "pause", "pthread_kill", "pthread_sigmask", "raise_signal", "set_wakeup_fd",
    "setitimer", "siginterrupt", "signal", "sigpending", "sigwait"]

[_socket]
immutable = ["error", "herror", "gaierror", "timeout"]
proxy = ["socket",
         "close",
         "dup",
         "getaddrinfo",
         "getdefaulttimeout",
         "gethostbyaddr",
         "gethostbyname",
         "gethostbyname_ex",
         "gethostname",
         "getnameinfo",
         "getprotobyname",
         "getservbyname",
         "getservbyport",
         "has_ipv6",
         "if_indextoname",
         "if_nameindex",
         "if_nametoindex",
         "setdefaulttimeout",
         "sethostname",
         "socketpair"]

[_socket.patch_class.socket]
recvfrom_into = "retracesoftware.install.edgecases.recvfrom_into"
recv_into = "retracesoftware.install.edgecases.recv_into"
recvmsg_into = "retracesoftware.install.edgecases.recvmsg_into"

[select]
proxy = ["kevent", "kqueue", "poll", "epoll", "select"]

[_ssl]
proxy = ["_SSLSocket", "MemoryBIO", "_SSLContext"]

[_ssl.patch_class._SSLSocket]
read = "retracesoftware.install.edgecases.read"

[ssl]
bind = ["Options"]

[_random]
proxy = ["Random"]

[_multiprocessing]
proxy = ["SemLock", "sem_unlink"]
